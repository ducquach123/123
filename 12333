-- Mini Menu GUI Script v·ªõi X-Ray (ƒë√£ lo·∫°i tr·ª´ to√†n b·ªô folder/model c√≥ t√™n ch·ª©a "claim")
-- ƒê·∫∑t trong StarterGui ho·∫∑c StarterPlayerScripts (LocalScript)

local Players = game:GetService('Players')
local UserInputService = game:GetService('UserInputService')
local Workspace = game:GetService('Workspace')

local player = Players.LocalPlayer
local playerGui = player:WaitForChild('PlayerGui')

-- üñ•Ô∏è T·∫°o ScreenGui
local screenGui = Instance.new('ScreenGui')
screenGui.Name = 'MiniMenu'
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

-- üéõÔ∏è Frame ch√≠nh (tƒÉng chi·ªÅu cao)
local mainFrame = Instance.new('Frame')
mainFrame.Name = 'MainFrame'
mainFrame.Size = UDim2.new(0, 200, 0, 165)
mainFrame.Position = UDim2.new(0, 10, 1, -175)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

local corner = Instance.new('UICorner')
corner.CornerRadius = UDim.new(0, 10)
corner.Parent = mainFrame

-- üè∑Ô∏è Ti√™u ƒë·ªÅ
local title = Instance.new('TextLabel')
title.Name = 'Title'
title.Size = UDim2.new(1, 0, 0, 30)
title.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
title.Text = 'Menu'
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.GothamBold
title.TextSize = 14
title.Parent = mainFrame

local titleCorner = Instance.new('UICorner')
titleCorner.CornerRadius = UDim.new(0, 10)
titleCorner.Parent = title

-- üî¥ N√∫t 1: X√≥a Avatar
local btnClearAvatar = Instance.new('TextButton')
btnClearAvatar.Name = 'ClearAvatarBtn'
btnClearAvatar.Size = UDim2.new(1, -20, 0, 35)
btnClearAvatar.Position = UDim2.new(0, 10, 0, 40)
btnClearAvatar.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
btnClearAvatar.Text = 'X√≥a Avatar (T·∫•t c·∫£)'
btnClearAvatar.TextColor3 = Color3.fromRGB(255, 255, 255)
btnClearAvatar.Font = Enum.Font.Gotham
btnClearAvatar.TextSize = 13
btnClearAvatar.Parent = mainFrame

local btn1Corner = Instance.new('UICorner')
btn1Corner.CornerRadius = UDim.new(0, 6)
btn1Corner.Parent = btnClearAvatar

-- üîµ N√∫t 2: Spam Slap
local btnSpamSlap = Instance.new('TextButton')
btnSpamSlap.Name = 'SpamSlapBtn'
btnSpamSlap.Size = UDim2.new(1, -20, 0, 35)
btnSpamSlap.Position = UDim2.new(0, 10, 0, 80)
btnSpamSlap.BackgroundColor3 = Color3.fromRGB(50, 150, 220)
btnSpamSlap.Text = 'Spam Slap: OFF (R)'
btnSpamSlap.TextColor3 = Color3.fromRGB(255, 255, 255)
btnSpamSlap.Font = Enum.Font.Gotham
btnSpamSlap.TextSize = 13
btnSpamSlap.Parent = mainFrame

local btn2Corner = Instance.new('UICorner')
btn2Corner.CornerRadius = UDim.new(0, 6)
btn2Corner.Parent = btnSpamSlap

-- üü£ N√∫t 3: X-Ray
local btnXRay = Instance.new('TextButton')
btnXRay.Name = 'XRayBtn'
btnXRay.Size = UDim2.new(1, -20, 0, 35)
btnXRay.Position = UDim2.new(0, 10, 0, 120)
btnXRay.BackgroundColor3 = Color3.fromRGB(150, 50, 220)
btnXRay.Text = 'X-Ray Plots: OFF'
btnXRay.TextColor3 = Color3.fromRGB(255, 255, 255)
btnXRay.Font = Enum.Font.Gotham
btnXRay.TextSize = 13
btnXRay.Parent = mainFrame

local btn3Corner = Instance.new('UICorner')
btn3Corner.CornerRadius = UDim.new(0, 6)
btn3Corner.Parent = btnXRay

-- ‚öôÔ∏è Bi·∫øn
local isSpamming = false
local xrayEnabled = false

-- X-Ray Variables
local ModifiedParts = {}
local OriginalProperties = {}
local XrayTransparency = 0.7

-- T√¨m folder Plots
local PlotsFolder = Workspace:FindFirstChild("Plots")
if not PlotsFolder then
    local possibleNames = {"Plot", "plots", "Buildings", "Houses", "Bases"}
    for _, name in ipairs(possibleNames) do
        PlotsFolder = Workspace:FindFirstChild(name)
        if PlotsFolder then
            break
        end
    end
end

-- üßπ H√†m x√≥a avatar
local function clearMyAvatar()
    player:ClearCharacterAppearance()
    print('‚úÖ ƒê√£ x√≥a outfit c·ªßa B·∫†N!')
end

local function clearAllAvatars()
    for _, plr in pairs(Players:GetPlayers()) do
        if plr.Character then
            plr:ClearCharacterAppearance()
        end
    end
    print('‚úÖ ƒê√£ x√≥a outfit c·ªßa T·∫§T C·∫¢ ng∆∞·ªùi ch∆°i (local only)')
end

if player.Character then
    clearMyAvatar()
else
    player.CharacterAdded:Wait()
    clearMyAvatar()
end

-- üîç Slap Tool
local function getSlapTool()
    local backpack = player:WaitForChild('Backpack')
    for _, item in pairs(backpack:GetChildren()) do
        if item:IsA('Tool') and string.find(string.lower(item.Name), 'slap') then
            return item
        end
    end
    local character = player.Character
    if character then
        for _, item in pairs(character:GetChildren()) do
            if item:IsA('Tool') and string.find(string.lower(item.Name), 'slap') then
                return item
            end
        end
    end
    return nil
end

local function startSpamSlap()
    task.spawn(function()
        while isSpamming do
            local character = player.Character
            if character then
                local humanoid = character:FindFirstChild('Humanoid')
                local tool = getSlapTool()
                if humanoid and tool then
                    if tool.Parent == player.Backpack then
                        humanoid:EquipTool(tool)
                    end
                    task.wait(0.1)
                else
                    task.wait(0.5)
                end
            else
                task.wait(0.5)
            end
        end
    end)
end

local function stopSpamSlap()
    isSpamming = false
end

-- üëÅÔ∏è X-Ray Functions
local function isInPlots(part)
    if not PlotsFolder then return false end
    local current = part
    while current and current ~= Workspace do
        if current == PlotsFolder then
            return true
        end
        current = current.Parent
    end
    return false
end

-- ‚öôÔ∏è M·ªõi: b·ªè to√†n b·ªô c√°c part n·∫±m trong folder/model c√≥ t√™n ch·ª©a ‚Äúclaim‚Äù
local function isInsideClaim(part)
    local current = part
    while current and current ~= Workspace do
        if string.find(string.lower(current.Name), "claim") then
            return true
        end
        current = current.Parent
    end
    return false
end

local function isWall(part)
    if not part:IsA("BasePart") then return false end
    if part.Parent and (part.Parent:FindFirstChild("Humanoid") or 
        (part.Parent.Parent and part.Parent.Parent:FindFirstChild("Humanoid"))) then
        return false
    end
    if isInsideClaim(part) then return false end
    if not isInPlots(part) then return false end
    return true
end

local function saveOriginalProperties(part)
    if not OriginalProperties[part] then
        OriginalProperties[part] = { Transparency = part.Transparency }
    end
end

local function applyXray(part)
    if isWall(part) then
        saveOriginalProperties(part)
        part.Transparency = XrayTransparency
        ModifiedParts[part] = true
    end
end

local function restorePart(part)
    if OriginalProperties[part] then
        local props = OriginalProperties[part]
        part.Transparency = props.Transparency
        ModifiedParts[part] = nil
    end
end

local function applyXrayToPlots()
    if not PlotsFolder then return end
    for _, obj in pairs(PlotsFolder:GetDescendants()) do
        if obj:IsA("BasePart") then
            applyXray(obj)
        end
    end
end

local function restorePlots()
    for part, _ in pairs(ModifiedParts) do
        if part and part.Parent then
            restorePart(part)
        end
    end
    ModifiedParts = {}
end

local function toggleXray()
    xrayEnabled = not xrayEnabled
    if xrayEnabled then
        btnXRay.Text = 'X-Ray Plots: ON'
        btnXRay.BackgroundColor3 = Color3.fromRGB(100, 220, 100)
        applyXrayToPlots()
    else
        btnXRay.Text = 'X-Ray Plots: OFF'
        btnXRay.BackgroundColor3 = Color3.fromRGB(150, 50, 220)
        restorePlots()
    end
end

btnClearAvatar.MouseButton1Click:Connect(function()
    clearAllAvatars()
    btnClearAvatar.BackgroundColor3 = Color3.fromRGB(100, 220, 100)
    task.wait(0.2)
    btnClearAvatar.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
end)

btnSpamSlap.MouseButton1Click:Connect(function()
    isSpamming = not isSpamming
    if isSpamming then
        btnSpamSlap.Text = 'Spam Slap: ON (R)'
        btnSpamSlap.BackgroundColor3 = Color3.fromRGB(50, 220, 100)
        startSpamSlap()
    else
        btnSpamSlap.Text = 'Spam Slap: OFF (R)'
        btnSpamSlap.BackgroundColor3 = Color3.fromRGB(50, 150, 220)
        stopSpamSlap()
    end
end)

btnXRay.MouseButton1Click:Connect(toggleXray)

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.R then
        isSpamming = not isSpamming
        if isSpamming then
            btnSpamSlap.Text = 'Spam Slap: ON (R)'
            btnSpamSlap.BackgroundColor3 = Color3.fromRGB(50, 220, 100)
            startSpamSlap()
        else
            btnSpamSlap.Text = 'Spam Slap: OFF (R)'
            btnSpamSlap.BackgroundColor3 = Color3.fromRGB(50, 150, 220)
            stopSpamSlap()
        end
    end
end)

if PlotsFolder then
    PlotsFolder.DescendantAdded:Connect(function(obj)
        if xrayEnabled and obj:IsA("BasePart") then
            task.wait(0.1)
            applyXray(obj)
        end
    end)
end
